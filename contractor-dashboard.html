<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contractor Dashboard – Roofing Marketplace</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>

  <!-- UNIVERSAL NAVIGATION -->
  <nav class="topbar">
    <a href="/" class="logo">Roofing Marketplace</a>
    <div class="nav-links">
      <a href="/">Overview</a>
      <a href="/features">Features</a>
      <a href="/roof-health">Roof Health</a>
      <a href="/dashboard">My Dashboard</a>
      <a href="/contractor-login">Contractors</a>
      <a href="/admin-dashboard">Admin</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="dashboard-hero-illustrated">
    <div class="hero-text">
      <h1>Contractor Control Center</h1>
      <p>Manage pricing, availability, service areas, and incoming leads.</p>
    </div>

    <div class="hero-illustration">
      <img src="https://images.unsplash.com/photo-1581091012184-5c7b6c2a5d79" alt="Contractor tools">
    </div>
  </header>

  <!-- PROFILE STATUS -->
  <section class="page-container">
    <h2>Your Profile</h2>
    <p id="contractor-status">Loading...</p>
  </section>

  <!-- PRICING MODEL -->
  <section class="page-container">
    <h2>Pricing Model</h2>
    <p>Set your pricing so the AI can generate accurate quotes for customers.</p>

    <div class="upload-box">
      <form id="pricing-form">
        <label>Price per Square (Architectural Shingle)</label>
        <input type="number" id="price-arch" placeholder="e.g. 350" />

        <label>Price per Square (3‑Tab Shingle)</label>
        <input type="number" id="price-3tab" placeholder="e.g. 300" />

        <label>Price per Square (Metal)</label>
        <input type="number" id="price-metal" placeholder="e.g. 550" />

        <button type="submit" class="cta-btn">Save Pricing</button>
      </form>
    </div>
  </section>

  <!-- SERVICE AREA -->
  <section class="page-container">
    <h2>Service Area</h2>
    <p>Enter the ZIP codes or cities where you accept jobs.</p>

    <div class="upload-box">
      <form id="service-area-form">
        <textarea id="service-area" placeholder="32084, 32086, Jacksonville, St Augustine..."></textarea>
        <button type="submit" class="cta-btn">Save Service Area</button>
      </form>
    </div>
  </section>

  <!-- AVAILABILITY -->
  <section class="page-container">
    <h2>Availability</h2>
    <p>Tell us when you're available for inspections or installs.</p>

    <div class="upload-box">
      <form id="availability-form">
        <label>Available Days</label>
        <input type="text" id="days" placeholder="Mon–Fri" />

        <label>Available Hours</label>
        <input type="text" id="hours" placeholder="8am–5pm" />

        <button type="submit" class="cta-btn">Save Availability</button>
      </form>
    </div>
  </section>

  <!-- LEADS -->
  <section class="page-container">
    <h2>Incoming Leads</h2>
    <p>These are customers matched to you based on pricing, area, and availability.</p>

    <div class="placeholder-box">
      <p>No leads yet. Leads will appear here as the matching engine connects to live customer traffic.</p>
    </div>
  </section>

  <script>
    // Load contractor session
    const contractor = JSON.parse(localStorage.getItem('contractorAccount') || 'null');
    const statusEl = document.getElementById('contractor-status');

    if (!contractor) {
      statusEl.textContent = 'Not logged in. Please log in as a contractor.';
    } else {
      statusEl.textContent =
        `Logged in as ${contractor.companyName} (${contractor.email}) — ` +
        (contractor.approved ? 'Approved' : 'Pending approval');
    }

    async function postJSON(url, body) {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify(body)
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    function getProfilePayload() {
      if (!contractor) return null;
      return {
        email: contractor.email,
        pricing: {
          arch: document.getElementById('price-arch').value,
          tab: document.getElementById('price-3tab').value,
          metal: document.getElementById('price-metal').value
        },
        serviceArea: document.getElementById('service-area').value,
        availability: {
          days: document.getElementById('days').value,
          hours: document.getElementById('hours').value
        }
      };
    }

    // Save pricing
    document.getElementById('pricing-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const payload = getProfilePayload();
        await postJSON('/api/contractor/profile', payload);
        alert('Pricing saved.');
      } catch (err) {
        alert('Error saving pricing: ' + err.message);
      }
    });

    // Save service area
    document.getElementById('service-area-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const payload = getProfilePayload();
        await postJSON('/api/contractor/profile', payload);
        alert('Service area saved.');
      } catch (err) {
        alert('Error saving service area: ' + err.message);
      }
    });

    // Save availability
    document.getElementById('availability-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const payload = getProfilePayload();
        await postJSON('/api/contractor/profile', payload);
        alert('Availability saved.');
      } catch (err) {
        alert('Error saving availability: ' + err.message);
      }
    });
  </script>

</body>
</html>
